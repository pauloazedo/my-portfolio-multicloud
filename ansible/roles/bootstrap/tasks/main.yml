---
# Cleanup old Docker APT sources (prevent Signed-By conflicts)
- name: Remove legacy Docker APT source file (if exists)
  ansible.builtin.file:
    path: /etc/apt/sources.list.d/docker.list
    state: absent

- name: Remove leftover Docker repo line from sources.list (if exists)
  ansible.builtin.lineinfile:
    path: /etc/apt/sources.list
    regexp: '^.*download\.docker\.com.*$'
    state: absent

# Update the system
- name: Update apt cache and upgrade packages
  ansible.builtin.apt:
    update_cache: true
    upgrade: dist
  tags: update

- name: Remove unnecessary packages
  ansible.builtin.apt:
    autoremove: true
  tags: update
